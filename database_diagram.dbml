// Database Diagram for Sistema de Proveedores
// Generated from Laravel migrations

Table users {
  id bigint [pk, increment]
  nombre varchar
  correo varchar [unique]
  fecha_verificacion_correo timestamp [null]
  password varchar
  remember_token varchar [null]
  rfc varchar(13)
  ultimo_acceso timestamp [null]
  estado enum('pendiente', 'activo', 'inactivo', 'suspendido') [default: 'pendiente']
  verification_token varchar [null]
  created_at timestamp
  updated_at timestamp
  deleted_at timestamp [null]
}

Table paises {
  id bigint [pk, increment]
  nombre varchar
  created_at timestamp
  updated_at timestamp
}

Table estados {
  id bigint [pk, increment]
  pais_id bigint [ref: > paises.id]
  nombre varchar
  created_at timestamp
  updated_at timestamp
}

Table municipios {
  id bigint [pk, increment]
  estado_id bigint [ref: > estados.id]
  nombre varchar(370)
  created_at timestamp
  updated_at timestamp
}

Table localidades {
  id bigint [pk, increment]
  municipio_id bigint [ref: > municipios.id]
  nombre varchar
  created_at timestamp
  updated_at timestamp
}

Table tipos_asentamiento {
  id bigint [pk, increment]
  nombre varchar(100)
  created_at timestamp
  updated_at timestamp
}

Table asentamientos {
  id bigint [pk, increment]
  nombre varchar(405)
  codigo_postal varchar(5)
  localidad_id bigint [ref: > localidades.id]
  tipo_asentamiento_id bigint [ref: > tipos_asentamiento.id]
  created_at timestamp
  updated_at timestamp
}

Table coordenadas {
  id bigint [pk, increment]
  latitud decimal(10,8)
  longitud decimal(11,8)
  created_at timestamp
  updated_at timestamp
}

Table sectores {
  id bigint [pk, increment]
  nombre varchar
  codigo varchar(10) [null]
  descripcion text [null]
  created_at timestamp
  updated_at timestamp
}

Table actividades_economicas {
  id bigint [pk, increment]
  sector_id bigint [ref: > sectores.id]
  nombre varchar
  codigo_scian varchar(10) [null]
  descripcion text [null]
  fuente varchar(50) [default: 'MANUAL']
  estado_validacion enum('Pendiente', 'Validada', 'Rechazada') [default: 'Pendiente']
  created_at timestamp
  updated_at timestamp
}

Table catalogo_archivos {
  id bigint [pk, increment]
  nombre varchar(100)
  descripcion text [null]
  tipo_persona enum('Física', 'Moral', 'Ambas') [default: 'Ambas']
  tipo_archivo enum('png', 'pdf', 'mp3')
  es_visible boolean [default: true]
  created_at timestamp
  updated_at timestamp
}

Table proveedores {
  id bigint [pk, increment]
  usuario_id bigint [ref: > users.id]
  pv_numero varchar(20) [unique, null]
  rfc varchar(13)
  tipo_persona enum('Física', 'Moral')
  estado_padron enum('Activo', 'Inactivo', 'Vencido', 'Pendiente', 'Rechazado') [default: 'Pendiente']
  es_activo boolean [default: true]
  fecha_alta_padron date [null]
  fecha_vencimiento_padron date [null]
  observaciones text [null]
  razon_social varchar [null]
  created_at timestamp
  updated_at timestamp
  
  indexes {
    (usuario_id, es_activo)
    estado_padron
    fecha_vencimiento_padron
  }
}

Table instrumentos_notariales {
  id bigint [pk, increment]
  numero_escritura varchar
  numero_escritura_constitutiva varchar [null]
  fecha_constitucion date
  nombre_notario varchar
  entidad_federativa varchar
  numero_notario int
  numero_registro_publico varchar
  fecha_inscripcion date
  created_at timestamp
  updated_at timestamp
}

Table tramites {
  id bigint [pk, increment]
  proveedor_id bigint [ref: > proveedores.id]
  tipo_tramite enum('Inscripcion', 'Renovacion', 'Actualizacion')
  estado enum('Pendiente', 'En_Revision', 'Aprobado', 'Rechazado', 'Por_Cotejar', 'Para_Correccion', 'Cancelado') [default: 'Pendiente']
  fecha_inicio timestamp [null]
  fecha_finalizacion timestamp [null]
  observaciones text [null]
  procesado_por bigint [null, ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table direcciones {
  id bigint [pk, increment]
  calle varchar
  entre_calles varchar [null]
  numero_exterior varchar(20) [null]
  numero_interior varchar(20) [null]
  codigo_postal varchar(10)
  colonia_asentamiento varchar
  municipio varchar
  id_estado bigint [ref: > estados.id]
  coordenadas_id bigint [null, ref: > coordenadas.id]
  id_tramite bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table datos_constitutivos {
  id bigint [pk, increment]
  instrumento_notarial_id bigint [ref: > instrumentos_notariales.id]
  tramite_id bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table apoderado_legal {
  id bigint [pk, increment]
  instrumento_notarial_id bigint [ref: > instrumentos_notariales.id]
  nombre_apoderado varchar
  rfc varchar
  tramite_id bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table datos_proveedores {
  id bigint [pk, increment]
  tramite_id bigint [null, ref: > tramites.id]
  rfc varchar(13) [null]
  curp varchar(18) [null]
  razon_social varchar [null]
  pagina_web varchar [null]
  telefono varchar(50) [null]
  created_at timestamp
  updated_at timestamp
}

Table contactos {
  id bigint [pk, increment]
  nombre_contacto varchar
  cargo varchar
  correo_electronico varchar
  telefono varchar(50)
  tramite_id bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table accionistas {
  id bigint [pk, increment]
  proveedor_id bigint [ref: > proveedores.id]
  nombre_completo varchar
  rfc varchar(13) [null]
  porcentaje_participacion decimal(5,2) [null]
  tramite_id bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table actividades_proveedores {
  id bigint [pk, increment]
  proveedor_id bigint [ref: > proveedores.id]
  actividad_id bigint [ref: > actividades_economicas.id]
  es_principal boolean [default: false]
  created_at timestamp
  updated_at timestamp
  
  indexes {
    (proveedor_id, actividad_id) [unique]
  }
}

Table archivos {
  id bigint [pk, increment]
  nombre_original varchar
  ruta_archivo varchar(500)
  idCatalogoArchivo bigint [ref: > catalogo_archivos.id]
  observaciones text [null]
  fecha_cotejo timestamp [null]
  cotejado_por bigint [null, ref: > users.id]
  aprobado boolean [default: false]
  tramite_id bigint [null, ref: > tramites.id]
  created_at timestamp
  updated_at timestamp
}

Table citas {
  id bigint [pk, increment]
  tramite_id bigint [ref: > tramites.id]
  proveedor_id bigint [ref: > proveedores.id]
  fecha_cita timestamp
  tipo_cita enum('Revision', 'Cotejo', 'Entrega')
  estado enum('Programada', 'Confirmada', 'Cancelada', 'Reagendada', 'Completada') [default: 'Programada']
  atendido_por bigint [null, ref: > users.id]
  created_at timestamp
  updated_at timestamp
}

Table notificaciones {
  id bigint [pk, increment]
  usuario_id bigint [ref: > users.id]
  tramite_id bigint [ref: > tramites.id]
  tipo enum('Sistema', 'Tramite', 'Cita', 'Vencimiento')
  titulo varchar
  mensaje text
  leida boolean [default: false]
  created_at timestamp
  updated_at timestamp
}

Table proveedor_contactos {
  id bigint [pk, increment]
  proveedor_id bigint [ref: > proveedores.id]
  nombre_completo varchar
  puesto varchar [null]
  telefono varchar [null]
  email varchar [null]
  created_at timestamp
  updated_at timestamp
  
  indexes {
    proveedor_id
  }
}

// Laravel System Tables
Table password_reset_tokens {
  correo varchar [pk]
  token varchar
  created_at timestamp [null]
}

Table sessions {
  id varchar [pk]
  user_id bigint [null, ref: > users.id]
  ip_address varchar(45) [null]
  user_agent text [null]
  payload text
  last_activity int
}

Table cache {
  key varchar [pk]
  value mediumtext
  expiration int
}

Table cache_locks {
  key varchar [pk]
  owner varchar
  expiration int
}

Table jobs {
  id bigint [pk, increment]
  queue varchar
  payload longtext
  attempts tinyint
  reserved_at int [null]
  available_at int
  created_at int
}

Table job_batches {
  id varchar [pk]
  name varchar
  total_jobs int
  pending_jobs int
  failed_jobs int
  failed_job_ids longtext
  options mediumtext [null]
  cancelled_at int [null]
  created_at int
  finished_at int [null]
}

Table failed_jobs {
  id bigint [pk, increment]
  uuid varchar [unique]
  connection text
  queue text
  payload longtext
  exception longtext
  failed_at timestamp [default: `now()`]
}

Table logs {
  id bigint [pk, increment]
  level varchar(20)
  message varchar(1000)
  channel varchar(100) [null]
  context text [null]
  user_id bigint [null, ref: > users.id]
  ip_address varchar(45) [null]
  user_agent varchar(500) [null]
  url varchar(1000) [null]
  method varchar(10) [null]
  created_at timestamp
  updated_at timestamp
}

// Permission Tables (Spatie Laravel Permission)
Table permissions {
  id bigint [pk, increment]
  name varchar
  guard_name varchar
  created_at timestamp
  updated_at timestamp
  
  indexes {
    (name, guard_name) [unique]
  }
}

Table roles {
  id bigint [pk, increment]
  name varchar
  guard_name varchar
  created_at timestamp
  updated_at timestamp
  
  indexes {
    (name, guard_name) [unique]
  }
}

Table model_has_permissions {
  permission_id bigint [ref: > permissions.id]
  model_type varchar
  model_id bigint
  
  indexes {
    (model_id, model_type)
    (permission_id, model_id, model_type) [pk]
  }
}

Table model_has_roles {
  role_id bigint [ref: > roles.id]
  model_type varchar
  model_id bigint
  
  indexes {
    (model_id, model_type)
    (role_id, model_id, model_type) [pk]
  }
}

Table role_has_permissions {
  permission_id bigint [ref: > permissions.id]
  role_id bigint [ref: > roles.id]
  
  indexes {
    (permission_id, role_id) [pk]
  }
}

// Activity Log Tables (Spatie Laravel Activitylog)
Table activity_log {
  id bigint [pk, increment]
  log_name varchar [null]
  description text
  subject_type varchar [null]
  subject_id bigint [null]
  event varchar [null]
  causer_type varchar [null]
  causer_id bigint [null]
  properties json [null]
  batch_uuid uuid [null]
  created_at timestamp
  updated_at timestamp
  
  indexes {
    log_name
    (subject_id, subject_type)
    (causer_id, causer_type)
  }
}